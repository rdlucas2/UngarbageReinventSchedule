<!DOCTYPE html>
<html>

<head>
    <title>
        Ungarbage Event Calendar
    </title>
    <!-- <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script> -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@5.11.3/main.css">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@5.11.3/main.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = null;

            fetch('http://localhost:8000/resources.json')
                .then((response) => response.json())
                .then((data) => {
                    resources = []
                    for (let i = 0; i < data.length; i++) {
                        resource = {
                            id: data[i],
                            title: data[i]
                        };
                        resources.push(resource);
                    }
                    calendar = new FullCalendar.Calendar(calendarEl, {
                        schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
                        initialView: 'resourceTimeline',
                        initialDate: '2022-11-28', //Date.now(),
                        resources: resources,
                        headerToolbar: {
                            left: 'prev,next today',
                            center: 'title',
                            right: 'dayGridMonth,timeGridWeek,timeGridDay,resourceTimeline,resourceTimeGridDay'
                        },
                        events: []
                    });

                    fetch('http://localhost:8000/api/events')
                        .then((response) => response.json())
                        .then((eventData) => {
                            let d = eventData.data
                            for (let i = 0; i < d.length; i++) {
                                resourceId = null;
                                if (d[i].venue && d[i].room) {
                                    resourceId = `${d[i].venue.name} ${d[i].room.name}`;
                                };
                                if (d[i].startTime && d[i].endTime) {
                                    //This is a very hacky way to do this, but I didn't want to use npm and webpack or some other build system for the frontend
                                    let isConferenceTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone !== 'America/Los_Angeles'
                                    event = {
                                        id: d[i].eventId,
                                        start: isConferenceTimezone ? d[i].startTime - 10800000 : d[i].startTime,
                                        end: isConferenceTimezone ? d[i].endTime - 10800000 : d[i].endTime,
                                        title: d[i].name,
                                        resourceId: resourceId
                                    };
                                    calendar.addEvent(event);
                                }
                            }
                            calendar.render();
                        });

                });
        });
    </script>
</head>

<body>
    <div id="calendar"></div>
</body>

</html>